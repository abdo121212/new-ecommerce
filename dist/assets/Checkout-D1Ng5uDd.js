import{r as c,C as F,b as O,U as T,j as e,y as r,a as b}from"./index-C-DsA9f1.js";import{c as C,a as d,u as B}from"./index.esm-zijc4Q6R.js";import{H as E}from"./Helmet-OhDTjJ-I.js";function I(){var u,m,g,x,y,f;const{cartInfo:l,getProductToCart:p}=c.useContext(F),[j,h]=c.useState(null),A=O(),v=/^(02)?01[0125][0-9]{8}/,{token:i}=c.useContext(T);console.log(i);async function N(o){let a=r.loading("Waiting",{position:"top-center"});try{const t={url:`https://ecommerce.routemisr.com/api/v1/orders/${l.cartId}`,method:"POST",headers:{token:i},data:o};let{data:n}=await b.request(t);n.status==="success"&&(r.success(n.status,{position:"top-center"}),p(),setTimeout(()=>{A("/orders")},2e3))}catch(t){r.success(t.response.data.message,{position:"top-center"}),console.log(t)}finally{r.dismiss(a,{position:"top-center"})}}async function w(o){let a=r.loading("Waiting");try{const t={url:`https://ecommerce.routemisr.com/api/v1/orders/checkout-session/${l.cartId}?url=${location.origin}`,method:"POST",headers:{token:i},data:o};let{data:n}=await b.request(t);n.status==="success"&&(r.success("Go to stripe"),p(),setTimeout(()=>{location.href=n.session.url},2e3))}catch(t){r.success(t.response.data.message)}finally{r.dismiss(a)}}const k=C({shippingAddress:C().shape({city:d().required("* City is required").min(2,"* City must be at least 2 characters long"),phone:d().matches(v,"* Phone must be 10 digits").required("* Phone is required"),details:d().required("* Details are required").min(10,"* Details must be at least 10 characters long")})}),s=B({initialValues:{shippingAddress:{details:"",phone:"",city:""}},validationSchema:k,onSubmit:o=>{j==="cash"?N(o):w(o)}}),P=((u=s.touched.shippingAddress)==null?void 0:u.phone)&&((m=s.errors.shippingAddress)==null?void 0:m.phone),S=((g=s.touched.shippingAddress)==null?void 0:g.city)&&((x=s.errors.shippingAddress)==null?void 0:x.city),q=((y=s.touched.shippingAddress)==null?void 0:y.details)&&((f=s.errors.shippingAddress)==null?void 0:f.details);return e.jsxs(e.Fragment,{children:[e.jsxs(E,{children:[e.jsx("title",{children:"Checkout - Freshcart"}),e.jsx("meta",{name:"description",content:"Complete your purchase and choose between online payment or cash on delivery at Freshcart."}),e.jsx("meta",{name:"keywords",content:"Checkout, Freshcart, Online Payment, Cash on Delivery, Shopping"}),e.jsx("meta",{property:"og:title",content:"Checkout - Freshcart"}),e.jsx("meta",{property:"og:description",content:"Finish your shopping experience and choose your preferred payment method at Freshcart."})]}),e.jsxs("section",{className:"container px-10 mx-auto w-full  py-5",children:[e.jsx("h1",{className:"font-bold text-2xl",children:"Shipping Address"}),e.jsxs("form",{className:"py-5 space-y-5 ",onSubmit:s.handleSubmit,children:[e.jsxs("div",{className:"city",children:[e.jsx("input",{className:"border-solid border-main focus:ring-0 focus:shadow-none focus:outline-none focus:border-main border-b-2 w-full",type:"text",name:"shippingAddress.city",onChange:s.handleChange,onBlur:s.handleBlur,value:s.values.shippingAddress.city,placeholder:"City"}),S&&e.jsx("p",{className:"text-red-600 font-medium",children:s.errors.shippingAddress.city})]}),e.jsxs("div",{className:"phone",children:[e.jsx("input",{className:"border-solid border-main focus:ring-0 border-b-2 w-full focus:outline-none focus:border-main ",type:"tel",name:"shippingAddress.phone",onChange:s.handleChange,onBlur:s.handleBlur,value:s.values.shippingAddress.phone,placeholder:"Phone"}),P&&e.jsx("p",{className:"text-red-600 font-medium",children:s.errors.shippingAddress.phone})]}),e.jsxs("div",{className:"details",children:[e.jsx("textarea",{className:"border-solid border-main focus:ring-0 border-b-2 w-full focus:outline-none focus:border-main ",name:"shippingAddress.details",onChange:s.handleChange,onBlur:s.handleBlur,value:s.values.shippingAddress.details,placeholder:"Details"}),q&&e.jsx("p",{className:"text-red-600 font-medium",children:s.errors.shippingAddress.details})]}),e.jsxs("div",{className:"btns flex gap-3 items-center flex-wrap  ",children:[e.jsx("button",{onClick:()=>{h("cash")},type:"submit",className:" bg-blue-600 hover:bg-blue-700 duration-300 transition-colors px-3 py-2 text-white rounded-2xl cursor-pointer",children:"Cash Order"}),e.jsx("button",{onClick:()=>{h("online")},type:"submit",className:" bg-main cursor-pointer text-white duration-300 transition-colors px-3 py-2 rounded-2xl",children:"Online Payment"})]})]})]})]})}export{I as default};
